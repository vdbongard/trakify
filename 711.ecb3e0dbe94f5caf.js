"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[711],{6711:(at,g,o)=>{o.r(g),o.d(g,{StatisticsModule:()=>tt});var v=o(6895),f=o(3162),C=o(858),O=o(5861),B=o(1135),F=o(2722),P=o(404),w=o(702),x=o(975),t=o(4650),y=o(4004),Z=o(9841);function p(e){return e?.reduce((i,s)=>i+s,0)??0}function E(e){return e.reduce((i,s)=>s?i+1:i,0)}var b=o(1463),j=o(9011),N=o(3022),G=o(7779),L=o(8357),R=o(5111),z=o(1545),J=o(2757),Q=o(214),Y=o(529);let I=(()=>{class e{constructor(s,n,a,r){this.showService=s,this.episodeService=n,this.tmdbService=a,this.http=r}fetchStats(s="me"){return this.http.get((0,L.m)(R.h.stats,[s])).pipe((0,G.L)(j.bB))}getStats$(){const s=this.showService.showsProgress.$.pipe((0,y.U)(a=>{const r=Object.values(a).map(h=>{const u=h?.seasons.map(d=>0===d.number?0:d.episodes.length);return p(u)}),m=Object.values(a).map(h=>{const u=h?.seasons.map(d=>0===d.number?0:d.episodes.filter(l=>l.completed).length);return p(u)});return{episodesCount:p(r),watchedEpisodesCount:p(m)}})),n=(0,Z.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,y.U)(([a,r,m,h,u])=>{const d=h?.map(c=>c.show.ids.trakt)??[],l=a?.map(c=>{if(d.includes(c.show.ids.trakt))return[!0,!1];const T=r[c.show.ids.trakt];if(!T)return[!0,!1];const S=T.next_episode,U=S&&m[(0,b.d)(c.show.ids.trakt,S.season,S.number)],it=!!U?.first_aired&&new Date(U.first_aired)<new Date,$=c.show.ids.tmdb?u[c.show.ids.tmdb]:void 0;return $?[(0,N.D)($),it]:[!0,!1]})??[],st=l.map(c=>c[0]),et=l.map(c=>c[1]),M=a?.length??0,A=E(st);return{showsCount:M,showsEndedCount:A,showsReturningCount:M-A,showsWithNextEpisodeCount:E(et)}}));return(0,Z.a)([s,n])}}return e.\u0275fac=function(s){return new(s||e)(t.LFG(z.X),t.LFG(J.n),t.LFG(Q.U),t.LFG(Y.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=o(7009),H=o(8424);let W=(()=>{class e{transform(s){const n=Math.trunc(s/60/24),a=Math.trunc(s/60%24),r=Math.trunc(s%60);return`${n} ${1===n?"day":"days"} ${a} ${1===a?"hour":"hours"} ${r} ${1===r?"minute":"minutes"}`}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=t.Yjl({name:"minutes",type:e,pure:!0}),e})();function X(e,i){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",4),t._uU(15),t.qZA(),t._UZ(16,"mat-progress-bar",7),t.qZA(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function K(e,i){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}const V=[{path:"",component:(()=>{class e extends P.H{constructor(s,n,a){super(),this.statsService=s,this.snackBar=n,this.cdr=a,this.pageState=new B.X(x.Gu.LOADING)}ngOnInit(){var n,s=this;this.statsService.getStats$().pipe((0,F.R)(this.destroy$)).subscribe({next:(n=(0,O.Z)(function*([a,r]){s.episodeStats=a,s.showStats=r,s.cdr.markForCheck()}),function(r){return n.apply(this,arguments)}),error:n=>(0,w.q)(n,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:n=>{this.stats=n,this.pageState.next(x.Gu.SUCCESS),this.cdr.markForCheck()},error:n=>(0,w.q)(n,this.snackBar,this.pageState)})}}return e.\u0275fac=function(s){return new(s||e)(t.Y36(I),t.Y36(D.ux),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["t-statistics"]],features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-title","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,n){1&s&&(t.YNc(0,X,17,8,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,K,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",n.episodeStats&&n.showStats),t.xp6(1),t.Q6J("loadingState",n.pageState),t.xp6(1),t.Q6J("ngIf",n.stats))},dependencies:[v.O5,H.N,f.pW,W],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}[_nghost-%COMP%]     .mat-list-base{margin-left:-1rem;margin-right:-1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0}),e})(),title:"Statistics - Trakify"}];let k=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.Bz.forChild(V),C.Bz]}),e})();var q=o(4466),_=o(4771);let tt=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[v.ez,k,q.m,_.ShowsModule,f.Cv]}),e})()}}]);