<a
  *ngIf="episode !== null && show && params"
  class="still-link link"
  [routerLink]="
    episode &&
    '/series/s/' +
      (params.slug ?? show.ids.slug) +
      '/season/' +
      (params.season ?? episode.season) +
      '/episode/' +
      (params.number ?? episode.number)
  "
  [class.not-loaded]="!stillLoaded"
>
  <img
    [src]="imgPrefix && tmdbEpisode?.still_path && imgPrefix + tmdbEpisode?.still_path"
    alt="Episode still"
    class="still"
    loading="lazy"
    width="1920"
    height="1080"
    appImageFallback="assets/still.png"
    (load)="stillLoaded = true"
  />
</a>

<ng-container *ngIf="withEpisode && episode && show && params">
  <a
    class="mat-subheading-1 title"
    [routerLink]="
      episode &&
      '/series/s/' +
        (params.slug ?? show.ids.slug) +
        '/season/' +
        (params.season ?? episode.season) +
        '/episode/' +
        (params.number ?? episode.number)
    "
  >
    S{{ episode.season | number: '2.0-0' }}E{{ episode.number | number: '2.0-0' }}
    {{ episode.title }}
    <span *ngIf="episode.first_aired" class="subtitle"
      >Â· {{ episode.first_aired | date: 'd. MMM. yyyy (E.)' }}</span
    >
  </a>
</ng-container>

<button
  *ngIf="episodeProgress || (episode?.season === 1 && episode?.number === 1)"
  mat-flat-button
  color="primary"
  (click)="episodeProgress?.completed ? removeFromHistory.emit() : addToHistory.emit()"
  class="mark-button"
>
  {{ episodeProgress?.completed ? 'Mark as unseen' : 'Mark as seen' }}
</button>

<ng-container *ngIf="episode">
  <p class="mat-body description">
    {{ episode.overview || 'No episode description.' }}
  </p>
  <p class="mat-body source">Source: TMDB</p>
</ng-container>
