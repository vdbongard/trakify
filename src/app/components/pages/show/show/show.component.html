<app-loading [loadingState]="loadingState">
  <ng-container *ngIf="showInfo">
    <div *ngIf="showInfo.tmdbShow" class="header">
      <img
        *ngIf="posterPrefix"
        [src]="posterPrefix + showInfo.tmdbShow.poster_path"
        width="185"
        height="278"
        [alt]="showInfo.tmdbShow.name + ' Poster'"
        class="poster"
        loading="lazy"
        appImageFallback
        imageFallback="assets/poster.png"
      />

      <div>
        <h4 class="mat-subheading-1 small-text">
          {{ showInfo.tmdbShow.status }} Â· {{ showInfo.tmdbShow.networks[0].name }}
        </h4>
        <h2 class="mat-headline">{{ showInfo.tmdbShow.name }}</h2>
        <p class="mat-body">{{ showInfo.tmdbShow.overview }}</p>
      </div>
    </div>

    <div *ngIf="showInfo.tmdbShow" class="next-episode">
      <ng-container *ngIf="params?.['slug'] && showInfo.nextEpisode !== null">
        <a
          class="mat-subheading-2 next-episode-text"
          [routerLink]="
            showInfo.nextEpisode &&
            '/series/s/' +
              params!['slug'] +
              '/season/' +
              showInfo.nextEpisode.season +
              '/episode/' +
              showInfo.nextEpisode.number
          "
        >
          Next episode:
          <ng-container *ngIf="showInfo.nextEpisode">
            S{{ showInfo.nextEpisode.season | number: '2.0-0' }}E{{
              showInfo.nextEpisode.number | number: '2.0-0'
            }}
            {{ showInfo.nextEpisode.title }}
          </ng-container>
        </a>
        <app-episode
          [params]="$any(params)"
          [show]="showInfo.show"
          [episode]="showInfo.nextEpisode"
          [episodeProgress]="showInfo.nextEpisodeProgress"
          [tmdbEpisode]="showInfo.tmdbNextEpisode"
          [imgPrefix]="stillPrefix"
          (addToHistory)="addToHistory(showInfo)"
        ></app-episode>
      </ng-container>

      <h3
        class="mat-subheading-2"
        *ngIf="
          showInfo.showWatched &&
          !showInfo.nextEpisode &&
          !['Ended', 'Canceled'].includes(showInfo.tmdbShow.status)
        "
      >
        No next episode
      </h3>
    </div>

    <mat-list *ngIf="params?.['slug'] && showInfo.showProgress">
      <a
        *ngFor="let seasonProgress of showInfo.showProgress.seasons"
        class="link"
        matRipple
        [matRippleDisabled]="true"
        appRipple
        [routerLink]="'/series/s/' + params!['slug'] + '/season/' + seasonProgress.number"
      >
        <mat-list-item>
          <app-season-item [seasonProgress]="seasonProgress"></app-season-item>
        </mat-list-item>
      </a>
    </mat-list>

    <mat-list *ngIf="params?.['slug'] && showInfo.tmdbShow && !showInfo.showProgress">
      <a
        *ngFor="let season of showInfo.tmdbShow.seasons"
        class="link"
        matRipple
        [matRippleDisabled]="true"
        appRipple
        [routerLink]="'/series/s/' + params!['slug'] + '/season/' + season.season_number"
      >
        <mat-list-item>
          <app-season-item [season]="season"></app-season-item>
        </mat-list-item>
      </a>
    </mat-list>
  </ng-container>
</app-loading>
