"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[205],{2205:(nt,w,o)=>{o.r(w),o.d(w,{StatisticsModule:()=>tt});var C=o(6895),x=o(3162),y=o(858),O=o(5861),B=o(1135),F=o(2722),H=o(5492),E=o(5606),Z=o(975),t=o(4650),l=o(9841),M=o(4004),p=o(7923),b=o(6321),j=o(9011),G=o(3022),I=o(8168),L=o(2313),R=o(95),z=o(6592),J=o(2042),Q=o(5507),Y=o(529);let D=(()=>{class e{constructor(s,n,i,r){this.showService=s,this.episodeService=n,this.tmdbService=i,this.http=r}fetchStats(s="me"){return this.http.get((0,L.m)(R.h.stats,[s])).pipe((0,I.L)(j.bB))}getStats$(){const s=(0,l.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,M.U)(([i,r,d,S,g])=>{const m=S?.map(c=>c.show.ids.trakt)??[],u=i?.map(c=>{if(m.includes(c.show.ids.trakt))return[!0,!1];const N=r[c.show.ids.trakt];if(!N)return[!0,!1];const f=N.next_episode,T=f&&d[(0,b.d)(c.show.ids.trakt,f.season,f.number)],ot=!!T?.first_aired&&new Date(T.first_aired)<new Date,U=c.show.ids.tmdb?g[c.show.ids.tmdb]:void 0;return U?[(0,G.D)(U),ot]:[!0,!1]})??[],h=u.map(c=>c[0]),v=u.map(c=>c[1]),A=i?.length??0,$=(0,p.w)(h);return{showsCount:A,showsEndedCount:$,showsReturningCount:A-$,showsWithNextEpisodeCount:(0,p.w)(v)}})),n=(0,l.a)([this.showService.showsProgress.$,this.showService.showsHidden.$]).pipe((0,M.U)(([i,r])=>{const d=this.getShowsNotHiddenProgress(i,r),S=d.map(m=>{const u=m?.seasons.map(h=>0===h.number?0:h.episodes.length);return(0,p.S)(u)}),g=d.map(m=>{const u=m?.seasons.map(h=>0===h.number?0:h.episodes.filter(v=>v.completed).length);return(0,p.S)(u)});return{episodesCount:(0,p.S)(S),watchedEpisodesCount:(0,p.S)(g)}}));return(0,l.a)([s,n])}getShowsNotHiddenProgress(s,n){const i=n?.map(d=>d.show.ids.trakt)??[];return Object.entries(s).filter(([d])=>!i.includes(parseInt(d))).map(d=>d[1])}}return e.\u0275fac=function(s){return new(s||e)(t.LFG(z.X),t.LFG(J.n),t.LFG(Q.U),t.LFG(Y.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var W=o(7009),P=o(8424);let X=(()=>{class e{transform(s){const n=Math.trunc(s/60/24),i=Math.trunc(s/60%24),r=Math.trunc(s%60);return`${n} ${1===n?"day":"days"} ${i} ${1===i?"hour":"hours"} ${r} ${1===r?"minute":"minutes"}`}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=t.Yjl({name:"minutes",type:e,pure:!0,standalone:!0}),e})();function K(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",4),t._uU(15),t.qZA(),t._UZ(16,"mat-progress-bar",7),t.qZA(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function V(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}const k=[{path:"",component:(()=>{class e extends H.H{constructor(s,n,i){super(),this.statsService=s,this.snackBar=n,this.cdr=i,this.pageState=new B.X(Z.Gu.LOADING)}ngOnInit(){var n,s=this;this.statsService.getStats$().pipe((0,F.R)(this.destroy$)).subscribe({next:(n=(0,O.Z)(function*([i,r]){s.cdr.markForCheck(),s.episodeStats=r,s.showStats=i}),function(r){return n.apply(this,arguments)}),error:n=>(0,E.q)(n,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:n=>{this.cdr.markForCheck(),this.stats=n,this.pageState.next(Z.Gu.SUCCESS)},error:n=>(0,E.q)(n,this.snackBar,this.pageState)})}}return e.\u0275fac=function(s){return new(s||e)(t.Y36(D),t.Y36(W.ux),t.Y36(t.sBO))},e.\u0275cmp=t.Xpm({type:e,selectors:[["t-statistics"]],features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-title","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,n){1&s&&(t.YNc(0,K,17,8,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,V,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",n.episodeStats&&n.showStats),t.xp6(1),t.Q6J("loadingState",n.pageState),t.xp6(1),t.Q6J("ngIf",n.stats))},dependencies:[C.O5,x.pW,P.N,X],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}[_nghost-%COMP%]     .mat-list-base{margin-left:-1rem;margin-right:-1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0}),e})(),title:"Statistics - Trakify"}];let q=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[y.Bz.forChild(k),y.Bz]}),e})();var _=o(4013);let tt=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.ez,q,_.ShowsModule,x.Cv,P.N]}),e})()}}]);