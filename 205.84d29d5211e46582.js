"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[205],{2205:(nt,Z,o)=>{o.r(Z),o.d(Z,{StatisticsModule:()=>w});var A=o(6895),H=o(3162),N=o(858),b=o(5861),j=o(1135),I=o(2722),W=o(1850),P=o(5606),T=o(975),t=o(4650),C=o(9841),U=o(4004),h=o(7923),z=o(6321),G=o(9011),L=o(3022),J=o(8168),Q=o(2313),Y=o(95),D=o(6592),R=o(2042),X=o(5507),K=o(529);class p{constructor(e,s,n,i){this.showService=e,this.episodeService=s,this.tmdbService=n,this.http=i}fetchStats(e="me"){return this.http.get((0,Q.m)(Y.h.stats,[e])).pipe((0,J.L)(G.bB))}getStats$(){const e=(0,C.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,U.U)(([n,i,a,m,v])=>{const x=m?.map(d=>d.show.ids.trakt)??[],f=n?.map(d=>{if(x.includes(d.show.ids.trakt))return[!0,!1];const B=i[d.show.ids.trakt];if(!B)return[!0,!1];const y=B.next_episode,F=y&&a[(0,z.d)(d.show.ids.trakt,y.season,y.number)],ot=!!F?.first_aired&&new Date(F.first_aired)<new Date,M=d.show.ids.tmdb?v[d.show.ids.tmdb]:void 0;return M?[(0,L.D)(M),ot]:[!0,!1]})??[],E=f.map(d=>d[0]),r=f.map(d=>d[1]),c=n?.length??0,O=(0,h.w)(E);return{showsCount:c,showsEndedCount:O,showsReturningCount:c-O,showsWithNextEpisodeCount:(0,h.w)(r)}})),s=(0,C.a)([this.showService.showsProgress.$,this.showService.showsHidden.$]).pipe((0,U.U)(([n,i])=>{const a=Object.values(n),m=this.getShowsNotHiddenProgress(n,i),v=a.map(r=>this.getEpisodeCount(r)),x=m.map(r=>this.getEpisodeCount(r)),f=a.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)}),E=m.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)});return{episodesCount:(0,h.S)(v),watchedEpisodesCount:(0,h.S)(f),notHiddenEpisodesCount:(0,h.S)(x),notHiddenWatchedEpisodesCount:(0,h.S)(E)}}));return(0,C.a)([e,s])}getShowsNotHiddenProgress(e,s){const n=s?.map(a=>a.show.ids.trakt)??[];return Object.entries(e).filter(([a])=>!n.includes(parseInt(a))).map(a=>a[1])}getWatchedEpisodes(e){return{...e,seasons:e.seasons.map(s=>({...s,episodes:s.episodes.filter(n=>n.completed)}))}}getEpisodeCount(e){const s=e?.seasons.map(n=>0===n.number?0:n.episodes.length);return(0,h.S)(s)}static#t=this.\u0275fac=function(s){return new(s||p)(t.LFG(D.X),t.LFG(R.n),t.LFG(X.U),t.LFG(K.eN))};static#s=this.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}var V=o(7009),$=o(8424);class g{transform(e){const s=Math.trunc(e/60/24),n=Math.trunc(e/60%24),i=Math.trunc(e%60);return`${s} ${1===s?"day":"days"} ${n} ${1===n?"hour":"hours"} ${i} ${1===i?"minute":"minutes"}`}static#t=this.\u0275fac=function(s){return new(s||g)};static#s=this.\u0275pipe=t.Yjl({name:"minutes",type:g,pure:!0,standalone:!0})}function k(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",7),t._uU(15),t.TgZ(16,"span",8),t._uU(17),t.qZA()(),t._UZ(18,"mat-progress-bar",9),t.qZA(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(2),t.AsE(" (",s.episodeStats.notHiddenWatchedEpisodesCount," / ",s.episodeStats.notHiddenEpisodesCount,") "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function q(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}class l extends W.X{constructor(e,s,n){super(),this.statsService=e,this.snackBar=s,this.cdr=n,this.pageState=new j.X(T.Gu.LOADING)}ngOnInit(){var s,e=this;this.statsService.getStats$().pipe((0,I.R)(this.destroy$)).subscribe({next:(s=(0,b.Z)(function*([n,i]){e.cdr.markForCheck(),e.episodeStats=i,e.showStats=n}),function(i){return s.apply(this,arguments)}),error:s=>(0,P.q)(s,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:s=>{this.cdr.markForCheck(),this.stats=s,this.pageState.next(T.Gu.SUCCESS)},error:s=>(0,P.q)(s,this.snackBar,this.pageState)})}static#t=this.\u0275fac=function(s){return new(s||l)(t.Y36(p),t.Y36(V.ux),t.Y36(t.sBO))};static#s=this.\u0275cmp=t.Xpm({type:l,selectors:[["t-statistics"]],features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-headline-6","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["title","Includes hidden shows",1,"mat-body","statistic-text"],["title","Excludes hidden shows",1,"statistic-text","subtext"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,n){1&s&&(t.YNc(0,k,19,10,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,q,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",n.episodeStats&&n.showStats),t.xp6(1),t.Q6J("loadingState",n.pageState),t.xp6(1),t.Q6J("ngIf",n.stats))},dependencies:[A.O5,H.pW,$.N,g],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text.subtext[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-color-2)}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0})}const _=[{path:"",component:l,title:"Statistics - Trakify"}];class S{static#t=this.\u0275fac=function(s){return new(s||S)};static#s=this.\u0275mod=t.oAB({type:S});static#e=this.\u0275inj=t.cJS({imports:[N.Bz.forChild(_),N.Bz]})}var tt=o(8564);class w{static#t=this.\u0275fac=function(s){return new(s||w)};static#s=this.\u0275mod=t.oAB({type:w});static#e=this.\u0275inj=t.cJS({imports:[A.ez,S,tt.ShowsModule,H.Cv,$.N]})}}}]);