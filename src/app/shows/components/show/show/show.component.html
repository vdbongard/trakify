<t-loading [loadingState]="pageState">
  <ng-container *ngIf="show$ | async as show">
    <ng-container *ngIf="{ value: showWatched$ | async } as showWatchedContext">
      <ng-container *ngIf="{ value: tmdbShow$ | async } as tmdbShowContext">
        <t-show-header
          [tmdbSeason]="tmdbSeason$ | async"
          [posterPrefix]="posterPrefix"
          [showWatched]="showWatchedContext.value"
          [tmdbShow]="tmdbShowContext.value"
          [show]="show"
          [isFavorite]="isFavorite$ | async"
          [isSmall]="isSmall"
          (addFavorite)="showService.addFavorite($event)"
          (removeFavorite)="showService.removeFavorite($event)"
        ></t-show-header>

        <ng-container *ngIf="{ value: showProgress$ | async } as showProgressContext">
          <ng-container *ngIf="nextEpisode$ | async as nextEpisode">
            <t-show-next-episode
              [nextEpisode]="nextEpisode"
              [showProgress]="showProgressContext.value"
              [tmdbShow]="tmdbShowContext.value"
              [show]="show"
              [seenLoading]="seenLoading | async"
              (addToHistory)="addToHistory($event, show, tmdbShowContext.value)"
              [showWatched]="showWatchedContext.value"
            ></t-show-next-episode>
          </ng-container>

          <t-show-seasons
            [showProgress]="showProgressContext.value"
            [tmdbShow]="tmdbShowContext.value"
          ></t-show-seasons>
        </ng-container>
      </ng-container>
    </ng-container>
  </ng-container>
</t-loading>
