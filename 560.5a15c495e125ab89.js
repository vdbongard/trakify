"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[560],{1560:(tt,E,n)=>{n.r(E),n.d(E,{default:()=>K});var A=n(5861),O=n(1135),b=n(2722),F=n(1850),y=n(5606),Z=n(975),t=n(4650);class m{transform(e){const s=Math.trunc(e/60/24),o=Math.trunc(e/60%24),i=Math.trunc(e%60);return`${s} ${1===s?"day":"days"} ${o} ${1===o?"hour":"hours"} ${i} ${1===i?"minute":"minutes"}`}static#t=this.\u0275fac=function(s){return new(s||m)};static#s=this.\u0275pipe=t.Yjl({name:"minutes",type:m,pure:!0,standalone:!0})}var M=n(8424),j=n(6895),H=n(3162),v=n(9841),P=n(4004),h=n(7923),I=n(6321),W=n(9011),B=n(3022),G=n(8168),L=n(2313),Q=n(95),Y=n(6592),z=n(2042),D=n(5507),J=n(529);class p{constructor(e,s,o,i){this.showService=e,this.episodeService=s,this.tmdbService=o,this.http=i}fetchStats(e="me"){return this.http.get((0,L.m)(Q.h.stats,[e])).pipe((0,G.L)(W.bB))}getStats$(){const e=(0,v.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,P.U)(([o,i,a,g,S])=>{const f=g?.map(d=>d.show.ids.trakt)??[],w=o?.map(d=>{if(f.includes(d.show.ids.trakt))return[!0,!1];const T=i[d.show.ids.trakt];if(!T)return[!0,!1];const x=T.next_episode,U=x&&a[(0,I.d)(d.show.ids.trakt,x.season,x.number)],_=!!U?.first_aired&&new Date(U.first_aired)<new Date,$=d.show.ids.tmdb?S[d.show.ids.tmdb]:void 0;return $?[(0,B.D)($),_]:[!0,!1]})??[],C=w.map(d=>d[0]),r=w.map(d=>d[1]),c=o?.length??0,N=(0,h.w)(C);return{showsCount:c,showsEndedCount:N,showsReturningCount:c-N,showsWithNextEpisodeCount:(0,h.w)(r)}})),s=(0,v.a)([this.showService.showsProgress.$,this.showService.showsHidden.$]).pipe((0,P.U)(([o,i])=>{const a=Object.values(o),g=this.getShowsNotHiddenProgress(o,i),S=a.map(r=>this.getEpisodeCount(r)),f=g.map(r=>this.getEpisodeCount(r)),w=a.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)}),C=g.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)});return{episodesCount:(0,h.S)(S),watchedEpisodesCount:(0,h.S)(w),notHiddenEpisodesCount:(0,h.S)(f),notHiddenWatchedEpisodesCount:(0,h.S)(C)}}));return(0,v.a)([e,s])}getShowsNotHiddenProgress(e,s){const o=s?.map(a=>a.show.ids.trakt)??[];return Object.entries(e).filter(([a])=>!o.includes(parseInt(a))).map(a=>a[1])}getWatchedEpisodes(e){return{...e,seasons:e.seasons.map(s=>({...s,episodes:s.episodes.filter(o=>o.completed)}))}}getEpisodeCount(e){const s=e?.seasons.map(o=>0===o.number?0:o.episodes.length);return(0,h.S)(s)}static#t=this.\u0275fac=function(s){return new(s||p)(t.LFG(Y.X),t.LFG(z.n),t.LFG(D.U),t.LFG(J.eN))};static#s=this.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}var R=n(7009);function X(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",7),t._uU(15),t.TgZ(16,"span",8),t._uU(17),t.qZA()(),t._UZ(18,"mat-progress-bar",9),t.qZA(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(2),t.AsE(" (",s.episodeStats.notHiddenWatchedEpisodesCount," / ",s.episodeStats.notHiddenEpisodesCount,") "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function k(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}class l extends F.X{constructor(e,s,o){super(),this.statsService=e,this.snackBar=s,this.cdr=o,this.pageState=new O.X(Z.Gu.LOADING)}ngOnInit(){var s,e=this;this.statsService.getStats$().pipe((0,b.R)(this.destroy$)).subscribe({next:(s=(0,A.Z)(function*([o,i]){e.cdr.markForCheck(),e.episodeStats=i,e.showStats=o}),function(i){return s.apply(this,arguments)}),error:s=>(0,y.q)(s,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:s=>{this.cdr.markForCheck(),this.stats=s,this.pageState.next(Z.Gu.SUCCESS)},error:s=>(0,y.q)(s,this.snackBar,this.pageState)})}static#t=this.\u0275fac=function(s){return new(s||l)(t.Y36(p),t.Y36(R.ux),t.Y36(t.sBO))};static#s=this.\u0275cmp=t.Xpm({type:l,selectors:[["t-statistics"]],standalone:!0,features:[t.qOj,t.jDz],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-headline-6","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["title","Includes hidden shows",1,"mat-body","statistic-text"],["title","Excludes hidden shows",1,"statistic-text","subtext"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,o){1&s&&(t.YNc(0,X,19,10,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,k,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",o.episodeStats&&o.showStats),t.xp6(1),t.Q6J("loadingState",o.pageState),t.xp6(1),t.Q6J("ngIf",o.stats))},dependencies:[j.O5,m,M.N,H.Cv,H.pW],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text.subtext[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-color-2)}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0})}const K=[{path:"",component:l,title:"Statistics - Trakify"}]}}]);