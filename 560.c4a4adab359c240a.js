"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[560],{1560:(tt,E,o)=>{o.r(E),o.d(E,{default:()=>V});var A=o(5861),b=o(1135),O=o(2722),M=o(1850),y=o(5606),Z=o(975),t=o(4650);class m{transform(e){const s=Math.trunc(e/60/24),n=Math.trunc(e/60%24),i=Math.trunc(e%60);return`${s} ${1===s?"day":"days"} ${n} ${1===n?"hour":"hours"} ${i} ${1===i?"minute":"minutes"}`}static#t=this.\u0275fac=function(s){return new(s||m)};static#s=this.\u0275pipe=t.Yjl({name:"minutes",type:m,pure:!0,standalone:!0})}var j=o(8424),I=o(6895),H=o(3162),v=o(9841),P=o(4004),h=o(7923),W=o(6321),F=o(9011),G=o(3022),L=o(8168),B=o(2313),Q=o(95),z=o(6592),Y=o(2042),D=o(5507),J=o(529);class p{constructor(e,s,n,i){this.showService=e,this.episodeService=s,this.tmdbService=n,this.http=i}fetchStats(e="me"){return this.http.get((0,B.m)(Q.h.stats,[e])).pipe((0,L.L)(F.bB))}getStats$(){const e=(0,v.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,P.U)(([n,i,a,g,S])=>{const f=g?.map(d=>d.show.ids.trakt)??[],w=n?.map(d=>{if(f.includes(d.show.ids.trakt))return[!0,!1];const T=i[d.show.ids.trakt];if(!T)return[!0,!1];const x=T.next_episode,U=x&&a[(0,W.d)(d.show.ids.trakt,x.season,x.number)],_=!!U?.first_aired&&new Date(U.first_aired)<new Date,$=d.show.ids.tmdb?S[d.show.ids.tmdb]:void 0;return $?[(0,G.D)($),_]:[!0,!1]})??[],C=w.map(d=>d[0]),r=w.map(d=>d[1]),c=n?.length??0,N=(0,h.w)(C);return{showsCount:c,showsEndedCount:N,showsReturningCount:c-N,showsWithNextEpisodeCount:(0,h.w)(r)}})),s=(0,v.a)([this.showService.showsProgress.$,this.showService.showsHidden.$]).pipe((0,P.U)(([n,i])=>{const a=Object.values(n),g=this.getShowsNotHiddenProgress(n,i),S=a.map(r=>this.getEpisodeCount(r)),f=g.map(r=>this.getEpisodeCount(r)),w=a.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)}),C=g.map(r=>{if(!r)return 0;const c=this.getWatchedEpisodes(r);return this.getEpisodeCount(c)});return{episodesCount:(0,h.S)(S),watchedEpisodesCount:(0,h.S)(w),notHiddenEpisodesCount:(0,h.S)(f),notHiddenWatchedEpisodesCount:(0,h.S)(C)}}));return(0,v.a)([e,s])}getShowsNotHiddenProgress(e,s){const n=s?.map(a=>a.show.ids.trakt)??[];return Object.entries(e).filter(([a])=>!n.includes(parseInt(a))).map(a=>a[1])}getWatchedEpisodes(e){return{...e,seasons:e.seasons.map(s=>({...s,episodes:s.episodes.filter(n=>n.completed)}))}}getEpisodeCount(e){const s=e?.seasons.map(n=>0===n.number?0:n.episodes.length);return(0,h.S)(s)}static#t=this.\u0275fac=function(s){return new(s||p)(t.LFG(z.X),t.LFG(Y.n),t.LFG(D.U),t.LFG(J.eN))};static#s=this.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}var R=o(7009);function X(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",7),t._uU(15),t.TgZ(16,"span",8),t._uU(17),t.qZA()(),t._UZ(18,"mat-progress-bar",9),t.qZA(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(2),t.AsE(" (",s.episodeStats.notHiddenWatchedEpisodesCount," / ",s.episodeStats.notHiddenEpisodesCount,") "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function K(u,e){if(1&u&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&u){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}class l extends M.X{constructor(e,s){super(),this.statsService=e,this.snackBar=s,this.pageState=new b.X(Z.Gu.LOADING)}ngOnInit(){var s,e=this;this.statsService.getStats$().pipe((0,O.R)(this.destroy$)).subscribe({next:(s=(0,A.Z)(function*([n,i]){e.episodeStats=i,e.showStats=n}),function(i){return s.apply(this,arguments)}),error:s=>(0,y.q)(s,this.snackBar,[this.pageState])}),this.statsService.fetchStats().subscribe({next:s=>{this.stats=s,this.pageState.next(Z.Gu.SUCCESS)},error:s=>(0,y.q)(s,this.snackBar,[this.pageState])})}static#t=this.\u0275fac=function(s){return new(s||l)(t.Y36(p),t.Y36(R.ux))};static#s=this.\u0275cmp=t.Xpm({type:l,selectors:[["t-statistics"]],standalone:!0,features:[t.qOj,t.jDz],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-headline-6","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["title","Includes hidden shows",1,"mat-body","statistic-text"],["title","Excludes hidden shows",1,"statistic-text","subtext"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,n){1&s&&(t.YNc(0,X,19,10,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,K,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",n.episodeStats&&n.showStats),t.xp6(1),t.Q6J("loadingState",n.pageState),t.xp6(1),t.Q6J("ngIf",n.stats))},dependencies:[I.O5,m,j.N,H.Cv,H.pW],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text.subtext[_ngcontent-%COMP%]{font-size:1rem;color:var(--text-color-2)}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"]})}const V=[{path:"",component:l,title:"Statistics - Trakify"}]}}]);