<ng-container *ngIf="episode !== null && show">
  <a
    class="still-link link"
    [routerLink]="
      show && episode
        ? ({
            show: show | showSlug,
            season: episode.season + '',
            episode: episode.number + ''
          } | ngGenericPipe: paths.episode)
        : null
    "
    [class.not-loaded]="!stillLoaded"
  >
    <img
      *ngIf="stillPrefix && tmdbEpisode?.still_path as stillPath; else imgFallback"
      [src]="stillPrefix + stillPath"
      width="1920"
      height="1080"
      fetchpriority="high"
      alt="Episode still"
      class="still"
      (load)="stillLoaded = true"
    />
    <ng-template #imgFallback>
      <img
        rawSrc="assets/still.png"
        width="800"
        height="450"
        priority
        alt="Still"
        (load)="stillLoaded = true"
      />
    </ng-template>
  </a>

  <a
    class="mat-subheading-1 title"
    [routerLink]="
      show && episode
        ? ({
            show: show | showSlug,
            season: episode.season + '',
            episode: episode.number + ''
          } | ngGenericPipe: paths.episode)
        : null
    "
  >
    <ng-container *ngIf="episode">
      S{{ episode.season | number: '2.0-0' }}E{{ episode.number | number: '2.0-0' }}
      {{ episode.title }}
      <span *ngIf="episode.first_aired" class="subtitle">
        Â· {{ episode.first_aired | date: 'd. MMM. yyyy (E.)' }}
      </span>
    </ng-container>
    <ng-container *ngIf="!episode">&nbsp;</ng-container>
  </a>

  <div *ngIf="episode" class="button button-container">
    <div *ngIf="isSeenLoading" class="spinner-container">
      <mat-spinner diameter="24" class="spinner"></mat-spinner>
    </div>
    <button
      mat-flat-button
      color="primary"
      (click)="episodeProgress?.completed ? removeEpisode.emit({episode, show}) : addEpisode.emit({ episode, show })"
      [disabled]="isSeenLoading || !episode || (episode.first_aired | isInFuture)"
    >
      {{
        episodeProgress
          ? episodeProgress.completed
            ? 'Mark as unseen'
            : 'Mark as seen'
          : 'Mark episode as seen'
      }}
    </button>
  </div>
  <ng-container *ngIf="isNewShow && episode">
    <button
      class="button"
      mat-flat-button
      color="primary"
      (click)="addSeason.emit({ episode, show })"
    >
      Mark season as seen
    </button>
    <button
      class="button"
      mat-flat-button
      color="primary"
      (click)="addShow.emit({ episode, show })"
    >
      Mark show as seen
    </button>
  </ng-container>
</ng-container>

<ng-container *ngIf="episode">
  <p class="mat-body description">
    {{ episode.overview || 'No episode description.' }}
  </p>
  <p class="mat-body source">Source: TMDB</p>
</ng-container>
