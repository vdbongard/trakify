"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[205],{2205:(nt,E,e)=>{e.r(E),e.d(E,{StatisticsModule:()=>v});var Z=e(6895),A=e(3162),$=e(858),b=e(5861),j=e(1135),G=e(2722),I=e(1850),N=e(5606),P=e(975),t=e(4650),C=e(9841),T=e(4004),d=e(7923),L=e(6321),z=e(9011),J=e(3022),Q=e(8168),Y=e(2313),D=e(95),R=e(6592),W=e(2042),X=e(5507),K=e(529);class p{constructor(o,s,n,i){this.showService=o,this.episodeService=s,this.tmdbService=n,this.http=i}fetchStats(o="me"){return this.http.get((0,Y.m)(D.h.stats,[o])).pipe((0,Q.L)(z.bB))}getStats$(){const o=(0,C.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,T.U)(([n,i,a,f,w])=>{const u=f?.map(r=>r.show.ids.trakt)??[],c=n?.map(r=>{if(u.includes(r.show.ids.trakt))return[!0,!1];const F=i[r.show.ids.trakt];if(!F)return[!0,!1];const y=F.next_episode,M=y&&a[(0,L.d)(r.show.ids.trakt,y.season,y.number)],ot=!!M?.first_aired&&new Date(M.first_aired)<new Date,H=r.show.ids.tmdb?w[r.show.ids.tmdb]:void 0;return H?[(0,J.D)(H),ot]:[!0,!1]})??[],h=c.map(r=>r[0]),x=c.map(r=>r[1]),O=n?.length??0,B=(0,d.w)(h);return{showsCount:O,showsEndedCount:B,showsReturningCount:O-B,showsWithNextEpisodeCount:(0,d.w)(x)}})),s=(0,C.a)([this.showService.showsProgress.$,this.showService.showsHidden.$]).pipe((0,T.U)(([n,i])=>{const a=this.getShowsNotHiddenProgress(n,i),f=a.map(u=>{const c=u?.seasons.map(h=>0===h.number?0:h.episodes.length);return(0,d.S)(c)}),w=a.map(u=>{const c=u?.seasons.map(h=>0===h.number?0:h.episodes.filter(x=>x.completed).length);return(0,d.S)(c)});return{episodesCount:(0,d.S)(f),watchedEpisodesCount:(0,d.S)(w)}}));return(0,C.a)([o,s])}getShowsNotHiddenProgress(o,s){const n=s?.map(a=>a.show.ids.trakt)??[];return Object.entries(o).filter(([a])=>!n.includes(parseInt(a))).map(a=>a[1])}static#t=this.\u0275fac=function(s){return new(s||p)(t.LFG(R.X),t.LFG(W.n),t.LFG(X.U),t.LFG(K.eN))};static#s=this.\u0275prov=t.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"})}var V=e(7009),U=e(8424);class g{transform(o){const s=Math.trunc(o/60/24),n=Math.trunc(o/60%24),i=Math.trunc(o%60);return`${s} ${1===s?"day":"days"} ${n} ${1===n?"hour":"hours"} ${i} ${1===i?"minute":"minutes"}`}static#t=this.\u0275fac=function(s){return new(s||g)};static#s=this.\u0275pipe=t.Yjl({name:"minutes",type:g,pure:!0,standalone:!0})}function k(m,o){if(1&m&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",4),t._uU(15),t.qZA(),t._UZ(16,"mat-progress-bar",7),t.qZA(),t.BQk()),2&m){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function q(m,o){if(1&m&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&m){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}class l extends I.X{constructor(o,s,n){super(),this.statsService=o,this.snackBar=s,this.cdr=n,this.pageState=new j.X(P.Gu.LOADING)}ngOnInit(){var s,o=this;this.statsService.getStats$().pipe((0,G.R)(this.destroy$)).subscribe({next:(s=(0,b.Z)(function*([n,i]){o.cdr.markForCheck(),o.episodeStats=i,o.showStats=n}),function(i){return s.apply(this,arguments)}),error:s=>(0,N.q)(s,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:s=>{this.cdr.markForCheck(),this.stats=s,this.pageState.next(P.Gu.SUCCESS)},error:s=>(0,N.q)(s,this.snackBar,this.pageState)})}static#t=this.\u0275fac=function(s){return new(s||l)(t.Y36(p),t.Y36(V.ux),t.Y36(t.sBO))};static#s=this.\u0275cmp=t.Xpm({type:l,selectors:[["t-statistics"]],features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-headline-6","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent","aria-label","Shows ended percentage of all shows added",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"],["mode","determinate","color","accent","aria-label","Watched episodes percentage of all aired episodes",1,"progress-bar",3,"value"]],template:function(s,n){1&s&&(t.YNc(0,k,17,8,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,q,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",n.episodeStats&&n.showStats),t.xp6(1),t.Q6J("loadingState",n.pageState),t.xp6(1),t.Q6J("ngIf",n.stats))},dependencies:[Z.O5,A.pW,U.N,g],styles:["[_nghost-%COMP%]{display:block;max-width:55rem;margin:0 auto;padding:1rem}[_nghost-%COMP%]     .mat-mdc-list-base{margin-left:-1rem;margin-right:-1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"],changeDetection:0})}const _=[{path:"",component:l,title:"Statistics - Trakify"}];class S{static#t=this.\u0275fac=function(s){return new(s||S)};static#s=this.\u0275mod=t.oAB({type:S});static#e=this.\u0275inj=t.cJS({imports:[$.Bz.forChild(_),$.Bz]})}var tt=e(8564);class v{static#t=this.\u0275fac=function(s){return new(s||v)};static#s=this.\u0275mod=t.oAB({type:v});static#e=this.\u0275inj=t.cJS({imports:[Z.ez,S,tt.ShowsModule,A.Cv,U.N]})}}}]);