// copy of _m3-palettes.scss helpers from material-experimental package
@use 'sass:color';
@use 'sass:map';
@use 'sass:math';

/// Estimate a hue using the given previous and next hues.
@function _estimate-hue($hues, $hue, $prev-hue, $next-hue) {
  $weight: math.div($next-hue - $hue, $next-hue - $prev-hue) * 100%;
  @return color.mix(map.get($hues, $prev-hue), map.get($hues, $next-hue), $weight);
}

// TODO(mmalerba): Remove this and add correct values for these hues.
/// The Material Design spec references some neutral hues that are not generated by
/// https://m3.material.io/theme-builder. For now we use this function to estimate the missing hues
/// by blending the nearest hues that are generated.
@function _patch-missing-hues($palette) {
  $neutral: map.get($palette, neutral);
  $palette: map.set($palette, neutral, 4, _estimate-hue($neutral, 4, 0, 10));
  $palette: map.set($palette, neutral, 6, _estimate-hue($neutral, 6, 0, 10));
  $palette: map.set($palette, neutral, 12, _estimate-hue($neutral, 12, 10, 20));
  $palette: map.set($palette, neutral, 17, _estimate-hue($neutral, 17, 10, 20));
  $palette: map.set($palette, neutral, 22, _estimate-hue($neutral, 22, 20, 25));
  $palette: map.set($palette, neutral, 24, _estimate-hue($neutral, 24, 20, 25));
  $palette: map.set($palette, neutral, 87, _estimate-hue($neutral, 87, 80, 90));
  $palette: map.set($palette, neutral, 92, _estimate-hue($neutral, 92, 90, 95));
  $palette: map.set($palette, neutral, 94, _estimate-hue($neutral, 94, 90, 95));
  $palette: map.set($palette, neutral, 96, _estimate-hue($neutral, 96, 95, 98));
  @return $palette;
}

/// Adds the error colors to the given palette.
@function _patch-error-palette($palette) {
  @return map.merge(
    $palette,
    (
      error: (
        0: #000000,
        10: #410002,
        20: #690005,
        25: #7e0007,
        30: #93000a,
        35: #a80710,
        40: #ba1a1a,
        50: #de3730,
        60: #ff5449,
        70: #ff897d,
        80: #ffb4ab,
        90: #ffdad6,
        95: #ffedea,
        98: #fff8f7,
        99: #fffbff,
        100: #ffffff,
      ),
    )
  );
}

@function apply-patches($palette) {
  @return _patch-missing-hues(_patch-error-palette($palette));
}
