"use strict";(self.webpackChunktrakify=self.webpackChunktrakify||[]).push([[861],{6861:(it,g,n)=>{n.r(g),n.d(g,{StatisticsModule:()=>_});var v=n(6895),f=n(3162),C=n(858),B=n(5861),O=n(1135),P=n(2722),j=n(5492),w=n(5606),x=n(975),t=n(4650),y=n(4004),Z=n(9841),F=n(9698);function p(e){return e?.reduce((i,s)=>i+s,0)??0}function E(e){return e.reduce((i,s)=>s?i+1:i,0)}var N=n(6321),b=n(9011),G=n(3022),L=n(1918),z=n(1420),J=n(249),Q=n(1621),R=n(529);let I=(()=>{class e{constructor(s,o,a,r){this.showService=s,this.episodeService=o,this.tmdbService=a,this.http=r}fetchStats(s="me"){return this.http.get(`${F.De.traktBaseUrl}/users/${s}/stats`).pipe((0,L.L)(b.bB))}getStats$(){const s=this.showService.showsProgress.$.pipe((0,y.U)(a=>{const r=Object.values(a).map(h=>{const u=h?.seasons.map(d=>0===d.number?0:d.episodes.length);return p(u)}),m=Object.values(a).map(h=>{const u=h?.seasons.map(d=>0===d.number?0:d.episodes.filter(S=>S.completed).length);return p(u)});return{episodesCount:p(r),watchedEpisodesCount:p(m)}})),o=(0,Z.a)([this.showService.showsWatched.$,this.showService.showsProgress.$,this.episodeService.showsEpisodes.$,this.showService.showsHidden.$,this.tmdbService.tmdbShows.$]).pipe((0,y.U)(([a,r,m,h,u])=>{const d=h?.map(c=>c.show.ids.trakt)??[],S=a?.map(c=>{if(d.includes(c.show.ids.trakt))return[!0,!1];const A=r[c.show.ids.trakt];if(!A)return[!0,!1];const l=A.next_episode,U=l&&m[(0,N.d)(c.show.ids.trakt,l.season,l.number)],ot=!!U?.first_aired&&new Date(U.first_aired)<new Date,T=c.show.ids.tmdb?u[c.show.ids.tmdb]:void 0;return T?[(0,G.D)(T),ot]:[!0,!1]})??[],tt=S.map(c=>c[0]),st=S.map(c=>c[1]),M=a?.length??0,$=E(tt);return{showsCount:M,showsEndedCount:$,showsReturningCount:M-$,showsWithNextEpisodeCount:E(st)}}));return(0,Z.a)([s,o])}}return e.\u0275fac=function(s){return new(s||e)(t.LFG(z.X),t.LFG(J.n),t.LFG(Q.U),t.LFG(R.eN))},e.\u0275prov=t.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Y=n(7009),D=n(8424);let H=(()=>{class e{transform(s){const o=Math.trunc(s/60/24),a=Math.trunc(s/60%24),r=Math.trunc(s%60);return`${o} ${1===o?"day":"days"} ${a} ${1===a?"hour":"hours"} ${r} ${1===r?"minute":"minutes"}`}}return e.\u0275fac=function(s){return new(s||e)},e.\u0275pipe=t.Yjl({name:"minutes",type:e,pure:!0}),e})();function W(e,i){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Shows"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.qZA(),t._UZ(6,"mat-progress-bar",5),t.TgZ(7,"p",6),t._uU(8),t.qZA(),t.TgZ(9,"p",6),t._uU(10),t.qZA()(),t.TgZ(11,"h2",2),t._uU(12,"Episodes"),t.qZA(),t.TgZ(13,"div",3)(14,"p",4),t._uU(15),t.qZA(),t._UZ(16,"mat-progress-bar",5),t.qZA(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.AsE(" ",s.showStats.showsEndedCount," / ",s.showStats.showsCount," "),t.xp6(1),t.Q6J("value",s.showStats.showsEndedCount/s.showStats.showsCount*100),t.xp6(2),t.hij("",s.showStats.showsReturningCount," shows running"),t.xp6(2),t.hij(" ",s.showStats.showsWithNextEpisodeCount," shows with next episode "),t.xp6(5),t.AsE(" ",s.episodeStats.watchedEpisodesCount," / ",s.episodeStats.episodesCount," "),t.xp6(1),t.Q6J("value",s.episodeStats.watchedEpisodesCount/s.episodeStats.episodesCount*100)}}function X(e,i){if(1&e&&(t.ynx(0),t.TgZ(1,"h2",2),t._uU(2,"Watched"),t.qZA(),t.TgZ(3,"div",3)(4,"p",4),t._uU(5),t.ALo(6,"minutes"),t.qZA()(),t.BQk()),2&e){const s=t.oxw();t.xp6(5),t.hij(" ",t.lcZ(6,1,s.stats.episodes.minutes)," ")}}const K=[{path:"",component:(()=>{class e extends j.H{constructor(s,o){super(),this.statsService=s,this.snackBar=o,this.pageState=new O.X(x.Gu.LOADING)}ngOnInit(){var o,s=this;this.statsService.getStats$().pipe((0,P.R)(this.destroy$)).subscribe({next:(o=(0,B.Z)(function*([a,r]){s.episodeStats=a,s.showStats=r}),function(r){return o.apply(this,arguments)}),error:o=>(0,w.q)(o,this.snackBar,this.pageState)}),this.statsService.fetchStats().subscribe({next:o=>{this.stats=o,this.pageState.next(x.Gu.SUCCESS)},error:o=>(0,w.q)(o,this.snackBar,this.pageState)})}}return e.\u0275fac=function(s){return new(s||e)(t.Y36(I),t.Y36(Y.ux))},e.\u0275cmp=t.Xpm({type:e,selectors:[["t-statistics"]],features:[t.qOj],decls:3,vars:3,consts:[[4,"ngIf"],[3,"loadingState"],[1,"mat-title","title"],[1,"statistic"],[1,"mat-body","statistic-text"],["mode","determinate","color","accent",1,"progress-bar",3,"value"],[1,"mat-body","statistic-text-small"]],template:function(s,o){1&s&&(t.YNc(0,W,17,8,"ng-container",0),t.TgZ(1,"t-loading",1),t.YNc(2,X,7,3,"ng-container",0),t.qZA()),2&s&&(t.Q6J("ngIf",o.episodeStats&&o.showStats),t.xp6(1),t.Q6J("loadingState",o.pageState),t.xp6(1),t.Q6J("ngIf",o.stats))},dependencies:[v.O5,D.N,f.pW,H],styles:["[_nghost-%COMP%]{display:block;max-width:50rem;margin:0 auto;padding:1rem}[_nghost-%COMP%]     .mat-list-base{margin-left:-1rem;margin-right:-1rem}.title[_ngcontent-%COMP%]{font-size:1rem;margin-bottom:0}.statistic[_ngcontent-%COMP%]{margin-top:.25rem;margin-bottom:2rem}.statistic-text[_ngcontent-%COMP%]{font-size:1.5rem;line-height:1.4;margin:0}.statistic-text-small[_ngcontent-%COMP%]{font-size:1rem}.progress-bar[_ngcontent-%COMP%]{margin:.5rem 0}"]}),e})(),title:"Statistics - Trakify"}];let V=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[C.Bz.forChild(K),C.Bz]}),e})();var k=n(4466),q=n(736);let _=(()=>{class e{}return e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[v.ez,V,k.m,q.ShowsModule,f.Cv]}),e})()}}]);